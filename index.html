<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>SMART HTML Viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-color: #f5f5f5;
      --text-color: #0f172a;
      --icon-color: #2563eb;
      --glow-color: #00aaff;
      --button-bg: #ffffff;
      --shadow-color: rgba(0, 170, 255, 0.35);
      --accent: #2563eb;
    }
    body.dark {
      --bg-color: #0b0f1a;
      --text-color: #e6edf7;
      --icon-color: #6ef3ff;
      --glow-color: #00c896;
      --button-bg: #121826;
      --shadow-color: rgba(110, 243, 255, 0.35);
      --accent: #6ef3ff;
    }
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 24px;
      transition: background 0.25s ease, color 0.25s ease;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 18px;
      color: var(--text-color);
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }
    .group { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    .device-button, .action-btn {
      width: 44px; height: 44px; border-radius: 10px; border: none;
      background: var(--button-bg);
      display: inline-flex; justify-content: center; align-items: center;
      font-size: 18px; cursor: pointer;
      box-shadow: 0 0 12px var(--shadow-color);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }
    .device-button i, .action-btn i { color: var(--icon-color); transition: color 0.2s ease; }
    .device-button:hover, .action-btn:hover { transform: translateY(-2px); box-shadow: 0 0 18px var(--glow-color); }

    .dropdown { position: relative; }
    .dropdown-content {
      position: absolute; top: calc(100% + 8px); right: 0;
      background: var(--button-bg); border-radius: 8px; box-shadow: 0 0 12px var(--shadow-color);
      padding: 8px; z-index: 10; display: none; min-width: 160px;
    }
    .dropdown.open .dropdown-content { display: block; }
    .dropdown-content button {
      width: 100%; margin: 4px 0; padding: 8px 10px; font-size: 14px;
      border: none; background: var(--button-bg); color: var(--text-color);
      cursor: pointer; border-radius: 6px; transition: background 0.2s, color 0.2s;
      text-align: right;
    }
    .dropdown-content button:hover { background: var(--accent); color: #fff; }

    select, input[type="number"] {
      padding: 8px 10px; border-radius: 10px; border: 1px solid var(--accent);
      background: var(--button-bg); color: var(--text-color); font-size: 14px;
      box-shadow: 0 0 8px var(--shadow-color);
    }

    .editor {
      width: 100%; min-height: 220px;
      padding: 12px; border-radius: 10px; border: 1px solid var(--accent);
      background: var(--button-bg); color: var(--text-color);
      font-family: monospace; font-size: 14px; resize: vertical;
      box-shadow: 0 0 12px var(--shadow-color);
    }

    .preview-wrap {
      margin-top: 16px;
      background: var(--button-bg);
      border: 1px solid var(--accent);
      border-radius: 12px;
      box-shadow: 0 0 12px var(--shadow-color);
      overflow: hidden;
      position: relative;
    }
    .preview-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 12px; border-bottom: 1px solid var(--accent);
      font-size: 13px; color: var(--text-color);
      background: rgba(0,0,0,0.04);
    }
    .preview-header .left { display:flex; gap:8px; align-items:center; }
    .chip {
      padding: 4px 8px; border-radius: 999px;
      background: rgba(0,0,0,0.06);
      border: 1px solid var(--accent);
      font-size: 12px;
    }
    iframe {
      display: block;
      width: 100%;
      height: 320px;
      background: #fff;
      border: none;
    }
    .resizer {
      position: absolute; bottom: 0; left: 0; right: 0;
      height: 10px; cursor: ns-resize;
      background: linear-gradient(90deg, transparent, var(--glow-color), transparent);
      opacity: 0.6;
    }

    footer { text-align: center; margin-top: 18px; font-size: 13px; opacity: 0.7; }
  </style>
</head>
<body>
  <h1 id="title">SMART HTML Viewer</h1>

  <div class="toolbar">
    <div class="group">
      <button class="device-button" data-device="laptop" title="لپ‌تاپ"><i class="fas fa-laptop"></i></button>
      <button class="device-button" data-device="tablet" title="تبلت"><i class="fas fa-tablet-alt"></i></button>
      <button class="device-button" data-device="mobile" title="موبایل"><i class="fas fa-mobile-alt"></i></button>
      <label class="chip">
        ارتفاع:
        <input id="heightInput" type="number" min="200" max="1200" step="20" style="width:80px; margin-inline-start:6px;">
        px
      </label>
    </div>
    <div class="group">
      <button class="action-btn" id="runBtn" title="اجرای کد"><i class="fas fa-play"></i></button>
      <button class="action-btn" id="copyBtn" title="کپی"><i class="fas fa-copy"></i></button>

      <div class="dropdown" id="downloadDropdown">
        <button class="action-btn" title="دانلود"><i class="fas fa-download"></i></button>
        <div class="dropdown-content">
          <button data-type="html">دانلود HTML</button>
          <button data-type="txt">دانلود TXT</button>
        </div>
      </div>

      <select id="languageSelect" title="زبان">
        <option value="fa">فارسی</option>
        <option value="en">English</option>
        <option value="ar">العربية</option>
        <option value="fr">Français</option>
        <option value="es">Español</option>
        <option value="zh">中文</option>
        <option value="de">Deutsch</option>
      </select>

      <button class="action-btn" id="themeToggle" title="تغییر حالت"><i class="fas fa-moon"></i></button>
    </div>
  </div>

  <textarea id="htmlInput" class="editor" placeholder="کد HTML خود را اینجا بنویسید..."></textarea>

  <div class="preview-wrap">
    <div class="preview-header">
      <div class="left">
        <span class="chip">پیش‌نمایش</span>
        <span id="deviceLabel" class="chip">عرض: 100%</span>
      </div>
      <span id="heightLabel" class="chip">ارتفاع: 320px</span>
    </div>
    <iframe id="preview" sandbox="allow-same-origin allow-forms allow-pointer-lock allow-popups allow-scripts"></iframe>
    <div class="resizer" id="resizer" title="برای تغییر ارتفاع بکشید"></div>
  </div>

  <footer>© <span id="year">2025</span> ساخته شده توسط <strong>Nima.Sh</strong> 🚀</footer>

  <script>
    // Translations
    const translations = {
      fa: { title: "SMART HTML Viewer", placeholder: "کد HTML خود را اینجا بنویسید..." },
      en: { title: "SMART HTML Viewer", placeholder: "Write your HTML code here..." },
      ar: { title: "SMART HTML Viewer", placeholder: "اكتب كود HTML هنا..." },
      fr: { title: "SMART HTML Viewer", placeholder: "Écrivez votre code HTML ici..." },
      es: { title: "SMART HTML Viewer", placeholder: "Escribe tu código HTML aquí..." },
      zh: { title: "SMART HTML Viewer", placeholder: "在此处编写您的 HTML 代码..." },
      de: { title: "SMART HTML Viewer", placeholder: "Schreiben Sie hier Ihren HTML-Code..." }
    };

    // Elements
    const titleEl = document.getElementById('title');
    const inputEl = document.getElementById('htmlInput');
    const iframeEl = document.getElementById('preview');
    const heightInput = document.getElementById('heightInput');
    const heightLabel = document.getElementById('heightLabel');
    const deviceLabel = document.getElementById('deviceLabel');
    const langSelect = document.getElementById('languageSelect');
    const themeToggle = document.getElementById('themeToggle');
    const runBtn = document.getElementById('runBtn');
    const copyBtn = document.getElementById('copyBtn');
    const dropdown = document.getElementById('downloadDropdown');
    const yearEl = document.getElementById('year');
    const resizer = document.getElementById('resizer');

    // State with localStorage
    const LS = {
      get: (k, d) => { const v = localStorage.getItem(k); return v !== null ? JSON.parse(v) : d; },
      set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
    };
    let state = {
      theme: LS.get('smart.theme', 'light'),
      lang: LS.get('smart.lang', 'fa'),
      device: LS.get('smart.device', 'fluid'),
      height: LS.get('smart.height', 320),
      code: LS.get('smart.code', '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Demo</title></head><body><h2 style="font-family:sans-serif">سلام نیمولی ✨</h2><p>این یک پیش‌نمایش سریع است.</p></body></html>')
    };

    // Init UI
    document.body.classList.toggle('dark', state.theme === 'dark');
    themeToggle.querySelector('i').className = state.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    langSelect.value = state.lang;
    titleEl.textContent = translations[state.lang]?.title || translations.fa.title;
    inputEl.placeholder = translations[state.lang]?.placeholder || translations.fa.placeholder;
    inputEl.value = state.code;
    heightInput.value = state.height;
    heightLabel.textContent = `ارتفاع: ${state.height}px`;
    yearEl.textContent = new Date().getFullYear();

    // Render function using srcdoc
    function renderHTML() {
      iframeEl.srcdoc = inputEl.value;
      LS.set('smart.code', inputEl.value);
    }
    renderHTML(); // initial render

    // Device preview widths
    function updateDevice(device) {
      let width;
      switch (device) {
        case 'laptop': width = 1024; break;
        case 'tablet': width = 768; break;
        case 'mobile': width = 390; break;
        default: width = '100%'; device = 'fluid';
      }
      iframeEl.style.width = typeof width === 'number' ? width + 'px' : width;
      deviceLabel.textContent = `عرض: ${typeof width === 'number' ? width + 'px' : '100%'}`;
      state.device = device; LS.set('smart.device', device);
    }
    updateDevice(state.device);

    // Height control
    function setHeight(h) {
      const clamped = Math.max(200, Math.min(1200, Number(h) || 320));
      iframeEl.style.height = clamped + 'px';
      heightLabel.textContent = `ارتفاع: ${clamped}px`;
      heightInput.value = clamped;
      state.height = clamped; LS.set('smart.height', clamped);
    }
    setHeight(state.height);

    // Language change
    function changeLanguage() {
      const lang = langSelect.value;
      const t = translations[lang] || translations.fa;
      titleEl.textContent = t.title;
      inputEl.placeholder = t.placeholder;
      // RTL/LTR handling for Arabic/FA vs others
      const rtl = (lang === 'fa' || lang === 'ar');
      document.documentElement.dir = rtl ? 'rtl' : 'ltr';
      document.documentElement.lang = lang;
      state.lang = lang; LS.set('smart.lang', lang);
    }

    // Theme toggle
    function toggleTheme() {
      const isDark = document.body.classList.toggle('dark');
      themeToggle.querySelector('i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
      state.theme = isDark ? 'dark' : 'light'; LS.set('smart.theme', state.theme);
    }

    // Copy to clipboard
    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(inputEl.value);
        toast('کد کپی شد!');
      } catch {
        alert('کپی ناموفق بود.');
      }
    }

    // Download file
    function downloadFile(type) {
      const code = inputEl.value;
      let blob, filename;
      if (type === 'html') {
        blob = new Blob([code], { type: 'text/html;charset=utf-8' });
        filename = 'smart-html-viewer-output.html';
      } else {
        blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
        filename = 'smart-html-viewer-output.txt';
      }
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // Tiny toast
    function toast(msg) {
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed';
      t.style.bottom = '16px';
      t.style.left = '50%';
      t.style.transform = 'translateX(-50%)';
      t.style.background = 'var(--button-bg)';
      t.style.color = 'var(--text-color)';
      t.style.border = '1px solid var(--accent)';
      t.style.boxShadow = '0 0 12px var(--shadow-color)';
      t.style.borderRadius = '10px';
      t.style.padding = '8px 12px';
      t.style.zIndex = '9999';
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1400);
    }

    // Events
    document.querySelectorAll('.device-button').forEach(btn => {
      btn.addEventListener('click', () => updateDevice(btn.dataset.device));
    });
    heightInput.addEventListener('input', () => setHeight(heightInput.value));
    langSelect.addEventListener('change', changeLanguage);
    themeToggle.addEventListener('click', toggleTheme);
    runBtn.addEventListener('click', renderHTML);
    copyBtn.addEventListener('click', copyToClipboard);

    // Dropdown interactions (mobile-friendly)
    dropdown.querySelector('button.action-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.classList.toggle('open');
    });
    dropdown.querySelectorAll('.dropdown-content button').forEach(b => {
      b.addEventListener('click', () => {
        downloadFile(b.dataset.type);
        dropdown.classList.remove('open');
      });
    });
    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
    });

    // Resizer drag
    (function enableResizer() {
      let dragging = false, startY = 0, startH = state.height;
      resizer.addEventListener('mousedown', (e) => { dragging = true; startY = e.clientY; startH = state.height; e.preventDefault(); });
      window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        const delta = e.clientY - startY;
        setHeight(startH + delta);
      });
      window.addEventListener('mouseup', () => dragging = false);
      // Touch
      resizer.addEventListener('touchstart', (e) => { dragging = true; startY = e.touches[0].clientY; startH = state.height; });
      window.addEventListener('touchmove', (e) => {
        if (!dragging) return;
        const delta = e.touches[0].clientY - startY;
        setHeight(startH + delta);
      }, { passive: false });
      window.addEventListener('touchend', () => dragging = false);
    })();

    // Auto-render on input (debounced)
    let renderTimer;
    inputEl.addEventListener('input', () => {
      clearTimeout(renderTimer);
      const value = inputEl.value;
      LS.set('smart.code', value);
      renderTimer = setTimeout(renderHTML, 250);
    });
  </script>
</body>
</html>
